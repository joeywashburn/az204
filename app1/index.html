
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="..">
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.11">
    
    
      
        <title>App 1 - AZ-204 Practice Guide</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.4af4bdda.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#task-management-web-app" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="AZ-204 Practice Guide" class="md-header__button md-logo" aria-label="AZ-204 Practice Guide" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            AZ-204 Practice Guide
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              App 1
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="AZ-204 Practice Guide" class="md-nav__button md-logo" aria-label="AZ-204 Practice Guide" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    AZ-204 Practice Guide
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    App 1
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    App 1
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#architecture" class="md-nav__link">
    <span class="md-ellipsis">
      Architecture
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#az-204-topics-covered" class="md-nav__link">
    <span class="md-ellipsis">
      AZ-204 Topics Covered
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    <span class="md-ellipsis">
      Prerequisites
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#getting-started" class="md-nav__link">
    <span class="md-ellipsis">
      Getting Started
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Getting Started">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-set-up-azure-app-service" class="md-nav__link">
    <span class="md-ellipsis">
      1. Set Up Azure App Service
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#modify-the-home-page-view-to-add-a-form-5-min" class="md-nav__link">
    <span class="md-ellipsis">
      Modify the Home Page View to Add a Form (~5 min):
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deploy-to-azure-app-service" class="md-nav__link">
    <span class="md-ellipsis">
      Deploy to Azure App Service
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#you-have-completed-the-set-up-azure-app-service-section" class="md-nav__link">
    <span class="md-ellipsis">
      You have completed the Set Up Azure App Service section.
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-azure-functions-for-apis" class="md-nav__link">
    <span class="md-ellipsis">
      Create Azure Functions for APIs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#you-have-completed-the-set-up-azure-functions-for-api-section" class="md-nav__link">
    <span class="md-ellipsis">
      You have completed the Set Up Azure Functions for API section.
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#set-up-cosmos-db" class="md-nav__link">
    <span class="md-ellipsis">
      Set Up Cosmos DB
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-database-and-container" class="md-nav__link">
    <span class="md-ellipsis">
      Create Database and Container
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#get-connection-strings" class="md-nav__link">
    <span class="md-ellipsis">
      Get Connection Strings:
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Get Connection Strings:">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#you-have-completed-the-set-up-cosmos-dbsection" class="md-nav__link">
    <span class="md-ellipsis">
      You have completed the Set Up Cosmos DBsection.
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#update-the-function-to-use-cosmos-db" class="md-nav__link">
    <span class="md-ellipsis">
      Update the Function to Use Cosmos DB
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Update the Function to Use Cosmos DB">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#add-the-cosmos-db-sdk" class="md-nav__link">
    <span class="md-ellipsis">
      Add the Cosmos DB SDK:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#add-the-connection-string-to-the-function-app" class="md-nav__link">
    <span class="md-ellipsis">
      Add the Connection String to the Function App:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#redeploy-the-functionapp" class="md-nav__link">
    <span class="md-ellipsis">
      Redeploy the FunctionApp
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#send-a-test" class="md-nav__link">
    <span class="md-ellipsis">
      Send a Test
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#you-have-completed-the-add-the-connection-string-to-the-function-app-section" class="md-nav__link">
    <span class="md-ellipsis">
      You have completed the Add the Connection String to the Function App Section.
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#update-the-homecontroller-with-the-function-app-changes" class="md-nav__link">
    <span class="md-ellipsis">
      Update the HomeController with the Function App changes.
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Update the HomeController with the Function App changes.">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#you-have-completed-the-update-the-homecontroller-with-the-function-app-changes-section" class="md-nav__link">
    <span class="md-ellipsis">
      You have completed the Update the HomeController with the Function App changes Section.
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#add-blob-storage" class="md-nav__link">
    <span class="md-ellipsis">
      Add Blob Storage
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Add Blob Storage">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#add-a-container" class="md-nav__link">
    <span class="md-ellipsis">
      Add a Container
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#add-the-keys-to-your-function-app" class="md-nav__link">
    <span class="md-ellipsis">
      Add the keys to your Function App
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#you-have-completed-the-add-blob-storage-section" class="md-nav__link">
    <span class="md-ellipsis">
      You have completed the Add Blob Storage Section.
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#update-the-createtask-function-to-handle-file-uploads" class="md-nav__link">
    <span class="md-ellipsis">
      Update the CreateTask Function to Handle File Uploads
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Update the CreateTask Function to Handle File Uploads">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#redeploy-the-function" class="md-nav__link">
    <span class="md-ellipsis">
      Redeploy the Function
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#you-have-completed-the-createtask-function-to-handle-file-uploads-section" class="md-nav__link">
    <span class="md-ellipsis">
      You have completed the CreateTask Function to Handle File Uploads Section.
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#update-files-to-support-file-uploads" class="md-nav__link">
    <span class="md-ellipsis">
      Update files to support File Uploads:
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Update files to support File Uploads:">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#update-the-web-app-form-to-include-file-upload" class="md-nav__link">
    <span class="md-ellipsis">
      Update the Web App Form to Include File Upload
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#update-homecontrollercs-to-handle-file-upload" class="md-nav__link">
    <span class="md-ellipsis">
      Update HomeController.cs to Handle File Upload:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#update-taskitemcs-to-include-attachmenturl" class="md-nav__link">
    <span class="md-ellipsis">
      Update TaskItem.cs to Include AttachmentUrl:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#application-insights" class="md-nav__link">
    <span class="md-ellipsis">
      Application Insights
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Application Insights">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-application-insights" class="md-nav__link">
    <span class="md-ellipsis">
      Create Application Insights
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#integrate-with-app-service" class="md-nav__link">
    <span class="md-ellipsis">
      Integrate with App Service
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#add-connection-string-to-app-service" class="md-nav__link">
    <span class="md-ellipsis">
      Add Connection String to App Service
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#redeploy-the-web-app" class="md-nav__link">
    <span class="md-ellipsis">
      Redeploy the Web App
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#you-have-completed-the-add-app-insights-to-app-service-section" class="md-nav__link">
    <span class="md-ellipsis">
      You have completed the Add App Insights to App Service Section.
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#integrate-with-azure-function" class="md-nav__link">
    <span class="md-ellipsis">
      Integrate with Azure Function
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#redeploy-the-function-app" class="md-nav__link">
    <span class="md-ellipsis">
      Redeploy the Function App:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#go-test-in-azure" class="md-nav__link">
    <span class="md-ellipsis">
      Go Test in Azure
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#architecture" class="md-nav__link">
    <span class="md-ellipsis">
      Architecture
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#az-204-topics-covered" class="md-nav__link">
    <span class="md-ellipsis">
      AZ-204 Topics Covered
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    <span class="md-ellipsis">
      Prerequisites
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#getting-started" class="md-nav__link">
    <span class="md-ellipsis">
      Getting Started
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Getting Started">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-set-up-azure-app-service" class="md-nav__link">
    <span class="md-ellipsis">
      1. Set Up Azure App Service
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#modify-the-home-page-view-to-add-a-form-5-min" class="md-nav__link">
    <span class="md-ellipsis">
      Modify the Home Page View to Add a Form (~5 min):
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deploy-to-azure-app-service" class="md-nav__link">
    <span class="md-ellipsis">
      Deploy to Azure App Service
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#you-have-completed-the-set-up-azure-app-service-section" class="md-nav__link">
    <span class="md-ellipsis">
      You have completed the Set Up Azure App Service section.
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-azure-functions-for-apis" class="md-nav__link">
    <span class="md-ellipsis">
      Create Azure Functions for APIs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#you-have-completed-the-set-up-azure-functions-for-api-section" class="md-nav__link">
    <span class="md-ellipsis">
      You have completed the Set Up Azure Functions for API section.
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#set-up-cosmos-db" class="md-nav__link">
    <span class="md-ellipsis">
      Set Up Cosmos DB
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-database-and-container" class="md-nav__link">
    <span class="md-ellipsis">
      Create Database and Container
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#get-connection-strings" class="md-nav__link">
    <span class="md-ellipsis">
      Get Connection Strings:
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Get Connection Strings:">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#you-have-completed-the-set-up-cosmos-dbsection" class="md-nav__link">
    <span class="md-ellipsis">
      You have completed the Set Up Cosmos DBsection.
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#update-the-function-to-use-cosmos-db" class="md-nav__link">
    <span class="md-ellipsis">
      Update the Function to Use Cosmos DB
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Update the Function to Use Cosmos DB">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#add-the-cosmos-db-sdk" class="md-nav__link">
    <span class="md-ellipsis">
      Add the Cosmos DB SDK:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#add-the-connection-string-to-the-function-app" class="md-nav__link">
    <span class="md-ellipsis">
      Add the Connection String to the Function App:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#redeploy-the-functionapp" class="md-nav__link">
    <span class="md-ellipsis">
      Redeploy the FunctionApp
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#send-a-test" class="md-nav__link">
    <span class="md-ellipsis">
      Send a Test
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#you-have-completed-the-add-the-connection-string-to-the-function-app-section" class="md-nav__link">
    <span class="md-ellipsis">
      You have completed the Add the Connection String to the Function App Section.
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#update-the-homecontroller-with-the-function-app-changes" class="md-nav__link">
    <span class="md-ellipsis">
      Update the HomeController with the Function App changes.
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Update the HomeController with the Function App changes.">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#you-have-completed-the-update-the-homecontroller-with-the-function-app-changes-section" class="md-nav__link">
    <span class="md-ellipsis">
      You have completed the Update the HomeController with the Function App changes Section.
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#add-blob-storage" class="md-nav__link">
    <span class="md-ellipsis">
      Add Blob Storage
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Add Blob Storage">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#add-a-container" class="md-nav__link">
    <span class="md-ellipsis">
      Add a Container
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#add-the-keys-to-your-function-app" class="md-nav__link">
    <span class="md-ellipsis">
      Add the keys to your Function App
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#you-have-completed-the-add-blob-storage-section" class="md-nav__link">
    <span class="md-ellipsis">
      You have completed the Add Blob Storage Section.
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#update-the-createtask-function-to-handle-file-uploads" class="md-nav__link">
    <span class="md-ellipsis">
      Update the CreateTask Function to Handle File Uploads
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Update the CreateTask Function to Handle File Uploads">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#redeploy-the-function" class="md-nav__link">
    <span class="md-ellipsis">
      Redeploy the Function
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#you-have-completed-the-createtask-function-to-handle-file-uploads-section" class="md-nav__link">
    <span class="md-ellipsis">
      You have completed the CreateTask Function to Handle File Uploads Section.
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#update-files-to-support-file-uploads" class="md-nav__link">
    <span class="md-ellipsis">
      Update files to support File Uploads:
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Update files to support File Uploads:">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#update-the-web-app-form-to-include-file-upload" class="md-nav__link">
    <span class="md-ellipsis">
      Update the Web App Form to Include File Upload
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#update-homecontrollercs-to-handle-file-upload" class="md-nav__link">
    <span class="md-ellipsis">
      Update HomeController.cs to Handle File Upload:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#update-taskitemcs-to-include-attachmenturl" class="md-nav__link">
    <span class="md-ellipsis">
      Update TaskItem.cs to Include AttachmentUrl:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#application-insights" class="md-nav__link">
    <span class="md-ellipsis">
      Application Insights
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Application Insights">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-application-insights" class="md-nav__link">
    <span class="md-ellipsis">
      Create Application Insights
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#integrate-with-app-service" class="md-nav__link">
    <span class="md-ellipsis">
      Integrate with App Service
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#add-connection-string-to-app-service" class="md-nav__link">
    <span class="md-ellipsis">
      Add Connection String to App Service
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#redeploy-the-web-app" class="md-nav__link">
    <span class="md-ellipsis">
      Redeploy the Web App
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#you-have-completed-the-add-app-insights-to-app-service-section" class="md-nav__link">
    <span class="md-ellipsis">
      You have completed the Add App Insights to App Service Section.
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#integrate-with-azure-function" class="md-nav__link">
    <span class="md-ellipsis">
      Integrate with Azure Function
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#redeploy-the-function-app" class="md-nav__link">
    <span class="md-ellipsis">
      Redeploy the Function App:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#go-test-in-azure" class="md-nav__link">
    <span class="md-ellipsis">
      Go Test in Azure
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="task-management-web-app">Task Management Web App</h1>
<p>A simple task management web application built with .NET, hosted on Azure App Service, using Azure Cosmos DB for storage, Azure Active Directory (AAD) for authentication, and Azure Monitor for insights. This project demonstrates key Azure services and concepts covered in the AZ-204 certification, including compute, storage, security, and monitoring.</p>
<h2 id="architecture">Architecture</h2>
<ul>
<li><strong>Frontend</strong>: .NET Core MVC (or React) hosted on Azure App Service.</li>
<li><strong>Backend</strong>: Azure Functions for serverless API endpoints handling CRUD operations.</li>
<li><strong>Database</strong>: Azure Cosmos DB (Core SQL API) for storing task data.</li>
<li><strong>Storage</strong>: Azure Blob Storage for task attachments (e.g., images).</li>
<li><strong>Authentication</strong>: Azure Active Directory for secure user login.</li>
<li><strong>Monitoring</strong>: Application Insights for performance telemetry.</li>
</ul>
<h2 id="az-204-topics-covered">AZ-204 Topics Covered</h2>
<ul>
<li><strong>Compute</strong>: Azure App Service Web Apps, Azure Functions.</li>
<li><strong>Storage</strong>: Azure Cosmos DB, Azure Blob Storage.</li>
<li><strong>Security</strong>: Azure AD authentication, role-based access control (RBAC).</li>
<li><strong>Monitoring</strong>: Application Insights for telemetry and diagnostics.</li>
<li><strong>Integration</strong>: Consuming Azure services via SDKs.</li>
</ul>
<h2 id="prerequisites">Prerequisites</h2>
<ul>
<li><strong>.NET SDK 8.0</strong> (<a href="https://learn.microsoft.com/en-us/dotnet/core/install/windows?tabs=net80#install-with-windows-package-manager-winget">Install via winget</a>: <code>winget install Microsoft.DotNet.SDK.8</code>)</li>
<li><strong>Azure CLI</strong> (<a href="https://learn.microsoft.com/en-us/cli/azure/install-azure-cli">Install</a>)</li>
<li><strong>Azure Functions Core Tools</strong> (<a href="https://github.com/Azure/azure-functions-core-tools/releases">Install</a>)</li>
<li><strong>Azure Subscription</strong> (Free tier or $200 credit recommended for minimal costs)</li>
</ul>
<h2 id="getting-started">Getting Started</h2>
<p>Follow these steps to set up and deploy the app locally and on Azure (~2.5 hours total).</p>
<h3 id="1-set-up-azure-app-service">1. Set Up Azure App Service</h3>
<ol>
<li>In the <a href="https://portal.azure.com">Azure Portal</a>, create a new App Service:</li>
<li>Use the <strong>Free F1 tier</strong> to avoid costs.</li>
<li>Note the app name (e.g., <code>taskmanagerweb-yourname</code>) and resource group (e.g., <code>az204exam</code>).</li>
<li>Check out the tabs for learning experience, we are leaving them default</li>
</ol>
<p><img alt="Portal Screenshot" src="../images/image1.png" />
2. Create a .NET Core MVC app locally:
   <code>bash
   dotnet new mvc -o TaskManagerWeb
   cd TaskManagerWeb
   dotnet run</code>
3. Verify the app runs at http://localhost:port
4. Launch your editor of choice:
   <code>bash
   code.</code>
5. Browse into the Models directory under TaskManagerWeb.
6. Add TaskItem.cs:
    <code>csharp
        namespace TaskManagerWeb.Models
        {
            public class TaskItem
            {
                public string id { get; set; } = System.Guid.NewGuid().ToString();
                public string? Title { get; set; }
                public string? Description { get; set; }
                public string? DueDate { get; set; } // Changed to string
            }
        }</code>
7. Update Controllers/HomeController.cs to handle tasks (in-memory for now):
    ```csharp
    using Microsoft.AspNetCore.Mvc;
    using TaskManagerWeb.Models;
    using System.Collections.Generic;</p>
<pre><code>namespace TaskManagerWeb.Controllers
{
    public class HomeController : Controller
    {
        private static List&lt;TaskItem&gt; _tasks = new List&lt;TaskItem&gt;();

        public IActionResult Index()
        {
            return View(_tasks);
        }

        [HttpPost]
        public IActionResult Create(string title, string description, DateTime dueDate)
        {
            var task = new TaskItem
            {
                Title = title,
                Description = description,
                DueDate = dueDate.ToString("yyyy-MM-dd") // Convert DateTime to string
            };
            _tasks.Add(task);
            return RedirectToAction("Index");
        }
    }
}
```
</code></pre>
<h3 id="modify-the-home-page-view-to-add-a-form-5-min">Modify the Home Page View to Add a Form (~5 min):</h3>
<p>The view (Index.cshtml) defines the UI, including the form for adding tasks and a list to display them.
1. Open Views/Home/Index.cshtml.
Replace the default content with:</p>
<pre><code class="language-html">@model List&lt;TaskManagerWeb.Models.TaskItem&gt;

&lt;h1&gt;Task Manager&lt;/h1&gt;

&lt;form asp-action=&quot;Create&quot; method=&quot;post&quot;&gt;
    &lt;div&gt;
        &lt;label&gt;Title:&lt;/label&gt;
        &lt;input type=&quot;text&quot; name=&quot;title&quot; required /&gt;
    &lt;/div&gt;
    &lt;div&gt;
        &lt;label&gt;Description:&lt;/label&gt;
        &lt;textarea name=&quot;description&quot;&gt;&lt;/textarea&gt;
    &lt;/div&gt;
    &lt;div&gt;
        &lt;label&gt;Due Date:&lt;/label&gt;
        &lt;input type=&quot;date&quot; name=&quot;dueDate&quot; required /&gt;
    &lt;/div&gt;
    &lt;button type=&quot;submit&quot;&gt;Add Task&lt;/button&gt;
&lt;/form&gt;

&lt;h2&gt;Tasks&lt;/h2&gt;
&lt;ul&gt;
    @if (Model != null &amp;&amp; Model.Any())
    {
        foreach (var task in Model)
        {
            &lt;li&gt;@task.Title - @task.Description (Due: @(task.DueDate ?? &quot;No due date&quot;))&lt;/li&gt;
        }
    }
    else
    {
        &lt;li&gt;No tasks yet.&lt;/li&gt;
    }
&lt;/ul&gt;
</code></pre>
<ol>
<li>Test the app works locally</li>
</ol>
<pre><code class="language-powershell">dotnet run
</code></pre>
<h3 id="deploy-to-azure-app-service">Deploy to Azure App Service</h3>
<ol>
<li>Push the app you created up to the Azure App Service we previously made.</li>
</ol>
<pre><code class="language-bash">az webapp up --name taskmanagerweb-yourname --resource-group az204exam --sku F1 --location yourlocation
</code></pre>
<ol>
<li>Test the app in your browser.  You should be able to get the URL from the App Service Overview page</li>
</ol>
<h3 id="you-have-completed-the-set-up-azure-app-service-section">You have completed the Set Up Azure App Service section.</h3>
<hr />
<h3 id="create-azure-functions-for-apis">Create Azure Functions for APIs</h3>
<p>In the <a href="https://portal.azure.com">Azure Portal</a>, create a new Function App:
- Check out the tabs for learning experience, we are leaving them default</p>
<p><img alt="consumption" src="../images/consumption.PNG" /></p>
<ol>
<li>From your root directory build your function</li>
</ol>
<pre><code class="language-bash">func init TaskManagerFunctions --dotnet
</code></pre>
<ol>
<li>Move into the TaskManagerFunctions dir</li>
</ol>
<pre><code class="language-bash">cd TaskManagerFunctions
</code></pre>
<ol>
<li>Build the function</li>
</ol>
<pre><code class="language-bash">func new --template &quot;HttpTrigger&quot; --name CreateTask
</code></pre>
<ol>
<li>Test your function locally first</li>
</ol>
<pre><code class="language-bash">func start
</code></pre>
<p>You should see output like</p>
<pre><code class="language-text">Functions:
    CreateTask: [GET,POST] http://localhost:7071/api/CreateTask
</code></pre>
<p>Open a browser and go to:</p>
<pre><code class="language-text">http://localhost:7071/api/CreateTask?name=Test
</code></pre>
<p>Expected response should be something like this:</p>
<pre><code class="language-text">This HTTP triggered function executed successfully. Pass a name in the query string or in the request body for a personalized response.
</code></pre>
<ol>
<li>Deploy to Azure: </li>
</ol>
<pre><code class="language-bash">func azure functionapp publish taskmanagerfunc-yourname #replace with your function name
</code></pre>
<p>Watch for the “Functions in taskmanagerfunc-yourname” section in the output. It should list:</p>
<pre><code class="language-text">Functions in taskmanagerfunc-yourname:
    CreateTask - [httpTrigger]
        Invoke url: https://taskmanagerfunc-yourname.azurewebsites.net/api/createtask?code=...
</code></pre>
<ol>
<li>Retrieve the Function Key</li>
</ol>
<pre><code class="language-bash">az functionapp function keys list --resource-group az204exam --name taskmanagerfunc-yourname --function-name CreateTask
</code></pre>
<ol>
<li>
<p>Save the default key value.  We are going to use it in the next step.</p>
</li>
<li>
<p>Test it out:</p>
</li>
<li>Construct the URL you need to test</li>
<li>Take your invoke url from Step 5 and append your default key.  It should look something like this</li>
</ol>
<pre><code class="language-bash">https://taskmanagerfunc-jwashburn.azurewebsites.net/api/createtask?code=THISISYOURCODEFROMSTEP7&amp;name=Test
</code></pre>
<ul>
<li>You should see something like:</li>
</ul>
<pre><code class="language-text">Hello, Test. This HTTP triggered function executed successfully.
</code></pre>
<h3 id="you-have-completed-the-set-up-azure-functions-for-api-section">You have completed the Set Up Azure Functions for API section.</h3>
<hr />
<h3 id="set-up-cosmos-db">Set Up Cosmos DB</h3>
<ol>
<li>In the Portal, go to “Azure Cosmos DB” &gt; “Create.  Choose NoSQL API”</li>
<li>Choose your settings.  You can refer to the sceenshot for details.  Again flip through the tabs to see what is there, but leave defaults</li>
</ol>
<p><img alt="CosmosDB" src="../images/cosmos.PNG" /></p>
<h2 id="create-database-and-container">Create Database and Container</h2>
<ul>
<li>In the Cosmos DB account, go to “Data Explorer.”</li>
<li>New Database: TasksDB.</li>
<li>New Container: Use Existing &gt; Choose TasksDB Tasks, Partition Key: /id, Throughput: 400 RU/s</li>
</ul>
<p><img alt="alt text" src="../images/image-2.png" /></p>
<h2 id="get-connection-strings">Get Connection Strings:</h2>
<ul>
<li>Go to Settings&gt; Keys copy the Primary Connection String.  Save them we are going to need them in a minute.</li>
</ul>
<h3 id="you-have-completed-the-set-up-cosmos-dbsection">You have completed the Set Up Cosmos DBsection.</h3>
<hr />
<h2 id="update-the-function-to-use-cosmos-db">Update the Function to Use Cosmos DB</h2>
<ul>
<li>Modify the CreateTask Function to save tasks to Cosmos DB.</li>
</ul>
<h3 id="add-the-cosmos-db-sdk">Add the Cosmos DB SDK:</h3>
<ol>
<li>In the TaskManagerFunctions directory</li>
</ol>
<pre><code class="language-powershell">cd TaskManagerFunctions
dotnet add package Microsoft.Azure.Cosmos
dotnet add package Microsoft.Azure.WebJobs.Extensions.CosmosDB
</code></pre>
<ol>
<li>Update CreateTask.cs</li>
<li>Replace the existing code with:</li>
</ol>
<pre><code class="language-csharp">using System.Threading.Tasks;
using Microsoft.AspNetCore.Mvc;
using Microsoft.Azure.WebJobs;
using Microsoft.Azure.WebJobs.Extensions.Http;
using Microsoft.AspNetCore.Http;
using Microsoft.Extensions.Logging;
using Microsoft.Azure.Cosmos;
using System.Text.Json;
using System.IO; // Added this line

namespace TaskManagerFunctions
{
    public class TaskItem
    {
        public string id { get; set; } = System.Guid.NewGuid().ToString();
        public string Title { get; set; }
        public string Description { get; set; }
        public string DueDate { get; set; }
    }

    public static class CreateTask
    {
        [FunctionName(&quot;CreateTask&quot;)]
        public static async Task&lt;IActionResult&gt; Run(
            [HttpTrigger(AuthorizationLevel.Function, &quot;post&quot;, Route = null)] HttpRequest req,
            [CosmosDB(databaseName: &quot;TasksDB&quot;, containerName: &quot;Tasks&quot;, Connection = &quot;CosmosDBConnection&quot;)] CosmosClient cosmosClient,
            ILogger log)
        {
            log.LogInformation(&quot;C# HTTP trigger function processed a request.&quot;);

            string requestBody = await new StreamReader(req.Body).ReadToEndAsync();
            var task = JsonSerializer.Deserialize&lt;TaskItem&gt;(requestBody);

            if (task == null || string.IsNullOrEmpty(task.Title) || string.IsNullOrEmpty(task.DueDate))
            {
                return new BadRequestObjectResult(&quot;Please provide a valid task with Title and DueDate.&quot;);
            }

            var container = cosmosClient.GetContainer(&quot;TasksDB&quot;, &quot;Tasks&quot;);
            await container.CreateItemAsync(task);

            return new OkObjectResult(&quot;Task created successfully.&quot;);
        }
    }
}
</code></pre>
<h3 id="add-the-connection-string-to-the-function-app">Add the Connection String to the Function App:</h3>
<ol>
<li>In the Portal, Go to your Function App. Settings &gt; Environment Variables</li>
<li>Click Add</li>
<li>Name: CosmosDBConnection.</li>
<li>Value: Paste the PRIMARY CONNECTION STRING from Cosmos DB.</li>
<li>Click Apply twice and confirm to make sure its saved.</li>
</ol>
<h3 id="redeploy-the-functionapp">Redeploy the FunctionApp</h3>
<pre><code class="language-powershell">func azure functionapp publish taskmanagerfunc-yourname
</code></pre>
<h3 id="send-a-test">Send a Test</h3>
<p>You could use POSTMAN or a CURL Command
Use the key from before.  If you need help getting that again run</p>
<pre><code class="language-powershell">az functionapp function keys list --resource-group az204exam --name taskmanagerfunc-yourname --function-name CreateTask
</code></pre>
<p>Feel free to send any message that makes sense to you</p>
<pre><code class="language-bash">curl -X POST -H &quot;Content-Type: application/json&quot; -d '{&quot;Title&quot;:&quot;Study AZ-204&quot;,&quot;Description&quot;:&quot;Review Cosmos DB&quot;,&quot;DueDate&quot;:&quot;2025-04-15&quot;}' &quot;https://taskmanagerfunc-jwashburn.azurewebsites.net/api/createtask?code=YOURCODEFROMBEFORE==&quot;
</code></pre>
<p>Go into the Azure Portal &gt; CosmosDB and drill down using Data Explorer and find your item
<img alt="data-explorer" src="../images/image-3.png" /></p>
<h3 id="you-have-completed-the-add-the-connection-string-to-the-function-app-section">You have completed the Add the Connection String to the Function App Section.</h3>
<hr />
<h2 id="update-the-homecontroller-with-the-function-app-changes">Update the HomeController with the Function App changes.</h2>
<p>Now we need to add some more settings to Environment Variables and update HomeController.cs</p>
<p>Go to the Azure Portal and go to your Web App.  Service &gt; Setting &gt; Environment Variables</p>
<p>Add 2 settings</p>
<ul>
<li>Name: FunctionSettings__CreateTaskUrl</li>
<li>
<p>Value: https://taskmanagerfunc-yourname.azurewebsites.net/api/createtask</p>
</li>
<li>
<p>Name: FunctionSettings__FunctionKey</p>
</li>
<li>Value: USE_YOUR_KEY_HERE</li>
</ul>
<p>Replace all the code in TaskManagerWeb/Controllers/HomeController.cs with this code</p>
<pre><code class="language-csharp">using Microsoft.AspNetCore.Mvc;
using TaskManagerWeb.Models;
using System.Collections.Generic;
using System.Net.Http;
using System.Text;
using System.Text.Json;
using System.Threading.Tasks;

namespace TaskManagerWeb.Controllers
{
    public class HomeController : Controller
    {
        private static List&lt;TaskItem&gt; _tasks = new List&lt;TaskItem&gt;(); // Temporary in-memory storage
        private readonly HttpClient _httpClient;
        private readonly string _functionUrl;

        public HomeController(IHttpClientFactory httpClientFactory, IConfiguration configuration)
        {
            _httpClient = httpClientFactory.CreateClient();
            var baseUrl = configuration[&quot;FunctionSettings:CreateTaskUrl&quot;];
            var functionKey = configuration[&quot;FunctionSettings:FunctionKey&quot;];
            _functionUrl = $&quot;{baseUrl}?code={functionKey}&quot;;
        }

        public IActionResult Index()
        {
            return View(_tasks);
        }

        [HttpPost]
        public async Task&lt;IActionResult&gt; Create(string title, string description, string dueDate)
        {
            var task = new TaskItem
            {
                Title = title,
                Description = description,
                DueDate = dueDate
            };

            var content = new StringContent(JsonSerializer.Serialize(task), Encoding.UTF8, &quot;application/json&quot;);
            var response = await _httpClient.PostAsync(_functionUrl, content);

            if (response.IsSuccessStatusCode)
            {
                _tasks.Add(task); // Still using in-memory for display; later replace with Cosmos DB read
                return RedirectToAction(&quot;Index&quot;);
            }

            ModelState.AddModelError(&quot;&quot;, &quot;Failed to create task.&quot;);
            return View(&quot;Index&quot;, _tasks);
        }
    }
}
</code></pre>
<p>Rebuild the app to get the changes into the code.</p>
<p>Make sure you are in your TaskManagerWeb directory</p>
<pre><code class="language-powershell">dotnet build
</code></pre>
<p>Push the changes up to Azure</p>
<pre><code class="language-powershell">az webapp up --name taskmanagerweb-jwashburn --resource-group az204exam --sku F1 --location westus
</code></pre>
<h3 id="you-have-completed-the-update-the-homecontroller-with-the-function-app-changes-section">You have completed the Update the HomeController with the Function App changes Section.</h3>
<hr />
<h2 id="add-blob-storage">Add Blob Storage</h2>
<p>In the Azure Portal Create a new Storage account</p>
<p>Look through the tabs for learning, but leave as default.</p>
<p><img alt="blob" src="../images/image-4.png" /></p>
<h3 id="add-a-container">Add a Container</h3>
<ul>
<li>Data_Storage&gt; Containers.  Add a Container</li>
<li>Name: attachments.</li>
<li>Go to Access Keys and copy the Connection String for Key1</li>
</ul>
<h3 id="add-the-keys-to-your-function-app">Add the keys to your Function App</h3>
<ul>
<li>Settings &gt; Environment Variables</li>
<li>Add a new application setting:</li>
<li>Name: BlobStorageConnectionString.</li>
<li>Value: Paste the Blob Storage connection string from the previous step</li>
</ul>
<h3 id="you-have-completed-the-add-blob-storage-section">You have completed the Add Blob Storage Section.</h3>
<hr />
<h2 id="update-the-createtask-function-to-handle-file-uploads">Update the CreateTask Function to Handle File Uploads</h2>
<p>In the TaskManagerFunctions directory, add the Blob Storage SDK</p>
<pre><code class="language-powershell">dotnet add package Azure.Storage.Blobs
dotnet add package Microsoft.Azure.WebJobs.Extensions.Storage
</code></pre>
<p>Update CreateTask.cs to handle a file upload and store it in Blob Storage:</p>
<pre><code class="language-csharp">using System.Threading.Tasks;
using Microsoft.AspNetCore.Mvc;
using Microsoft.Azure.WebJobs;
using Microsoft.Azure.WebJobs.Extensions.Http;
using Microsoft.AspNetCore.Http;
using Microsoft.Extensions.Logging;
using Microsoft.Azure.Cosmos;
using System.Text.Json;
using System.IO;
using Azure.Storage.Blobs;

namespace TaskManagerFunctions
{
    public class TaskItem
    {
        public string id { get; set; } = System.Guid.NewGuid().ToString();
        public string Title { get; set; }
        public string Description { get; set; }
        public string DueDate { get; set; }
        public string AttachmentUrl { get; set; } // Add this to store the Blob URL
    }

    public static class CreateTask
    {
        [FunctionName(&quot;CreateTask&quot;)]
        public static async Task&lt;IActionResult&gt; Run(
            [HttpTrigger(AuthorizationLevel.Function, &quot;post&quot;, Route = null)] HttpRequest req,
            [CosmosDB(databaseName: &quot;TasksDB&quot;, containerName: &quot;Tasks&quot;, Connection = &quot;CosmosDBConnection&quot;)] CosmosClient cosmosClient,
            [Blob(&quot;attachments&quot;, Connection = &quot;BlobStorageConnectionString&quot;)] BlobContainerClient blobContainerClient,
            ILogger log)
        {
            log.LogInformation(&quot;C# HTTP trigger function processed a request.&quot;);

            if (!req.HasFormContentType)
            {
                return new BadRequestObjectResult(&quot;Please send a multipart form request.&quot;);
            }

            var form = await req.ReadFormAsync();
            var title = form[&quot;title&quot;];
            var description = form[&quot;description&quot;];
            var dueDate = form[&quot;dueDate&quot;];

            if (string.IsNullOrEmpty(title) || string.IsNullOrEmpty(dueDate))
            {
                return new BadRequestObjectResult(&quot;Please provide a valid task with Title and DueDate.&quot;);
            }

            var task = new TaskItem
            {
                Title = title,
                Description = description,
                DueDate = dueDate
            };

            // Handle file upload
            var files = form.Files;
            if (files.Count &gt; 0)
            {
                var file = files[0];
                if (file.Length &gt; 0)
                {
                    var blobName = $&quot;{task.id}/{file.FileName}&quot;;
                    var blobClient = blobContainerClient.GetBlobClient(blobName);
                    using (var stream = file.OpenReadStream())
                    {
                        await blobClient.UploadAsync(stream, overwrite: true);
                    }
                    task.AttachmentUrl = blobClient.Uri.ToString();
                }
            }

            var container = cosmosClient.GetContainer(&quot;TasksDB&quot;, &quot;Tasks&quot;);
            await container.CreateItemAsync(task);

            return new OkObjectResult(&quot;Task created successfully.&quot;);
        }
    }
}
</code></pre>
<h3 id="redeploy-the-function">Redeploy the Function</h3>
<p>Deploy the updated Function:</p>
<pre><code class="language-powershell">func azure functionapp publish taskmanagerfunc-jwashburn
</code></pre>
<h3 id="you-have-completed-the-createtask-function-to-handle-file-uploads-section">You have completed the CreateTask Function to Handle File Uploads Section.</h3>
<hr />
<h3 id="update-files-to-support-file-uploads">Update files to support File Uploads:</h3>
<h4 id="update-the-web-app-form-to-include-file-upload">Update the Web App Form to Include File Upload</h4>
<ul>
<li>Open TaskManagerWeb/Views/Home/Index.cshtml and change your code to this</li>
</ul>
<pre><code class="language-csharp">@model List&lt;TaskManagerWeb.Models.TaskItem&gt;

&lt;h1&gt;Task Manager&lt;/h1&gt;

&lt;form asp-action=&quot;Create&quot; method=&quot;post&quot; enctype=&quot;multipart/form-data&quot;&gt;
    &lt;div&gt;
        &lt;label&gt;Title:&lt;/label&gt;
        &lt;input type=&quot;text&quot; name=&quot;title&quot; required /&gt;
    &lt;/div&gt;
    &lt;div&gt;
        &lt;label&gt;Description:&lt;/label&gt;
        &lt;textarea name=&quot;description&quot;&gt;&lt;/textarea&gt;
    &lt;/div&gt;
    &lt;div&gt;
        &lt;label&gt;Due Date:&lt;/label&gt;
        &lt;input type=&quot;date&quot; name=&quot;dueDate&quot; required /&gt;
    &lt;/div&gt;
    &lt;div&gt;
        &lt;label&gt;Attachment:&lt;/label&gt;
        &lt;input type=&quot;file&quot; name=&quot;attachment&quot; /&gt;
    &lt;/div&gt;
    &lt;button type=&quot;submit&quot;&gt;Add Task&lt;/button&gt;
&lt;/form&gt;

&lt;h2&gt;Tasks&lt;/h2&gt;
&lt;ul&gt;
    @if (Model != null &amp;&amp; Model.Any())
    {
        foreach (var task in Model)
        {
            &lt;li&gt;
                @task.Title - @task.Description (Due: @(task.DueDate ?? &quot;No due date&quot;))
                @if (!string.IsNullOrEmpty(task.AttachmentUrl))
                {
                    &lt;a href=&quot;@task.AttachmentUrl&quot; target=&quot;_blank&quot;&gt;View Attachment&lt;/a&gt;
                }
            &lt;/li&gt;
        }
    }
    else
    {
        &lt;li&gt;No tasks yet.&lt;/li&gt;
    }
&lt;/ul&gt;
</code></pre>
<h4 id="update-homecontrollercs-to-handle-file-upload">Update HomeController.cs to Handle File Upload:</h4>
<ul>
<li>Update TaskMangerWeb/Controllers/HomeController.cs to send the form data (including the file) to the Function with these code changes:</li>
</ul>
<pre><code class="language-csharp">using Microsoft.AspNetCore.Mvc;
using TaskManagerWeb.Models;
using System.Collections.Generic;
using System.Net.Http;
using System.Threading.Tasks;

namespace TaskManagerWeb.Controllers
{
    public class HomeController : Controller
    {
        private static List&lt;TaskItem&gt; _tasks = new List&lt;TaskItem&gt;(); // Temporary in-memory storage
        private readonly HttpClient _httpClient;
        private readonly string _functionUrl;

        public HomeController(IHttpClientFactory httpClientFactory, IConfiguration configuration)
        {
            _httpClient = httpClientFactory.CreateClient();
            var baseUrl = configuration[&quot;FunctionSettings:CreateTaskUrl&quot;];
            var functionKey = configuration[&quot;FunctionSettings:FunctionKey&quot;];
            _functionUrl = $&quot;{baseUrl}?code={functionKey}&quot;;
        }

        public IActionResult Index()
        {
            return View(_tasks);
        }

        [HttpPost]
        public async Task&lt;IActionResult&gt; Create(string title, string description, string dueDate, IFormFile attachment)
        {
            var formData = new MultipartFormDataContent();
            formData.Add(new StringContent(title ?? &quot;&quot;), &quot;title&quot;);
            formData.Add(new StringContent(description ?? &quot;&quot;), &quot;description&quot;);
            formData.Add(new StringContent(dueDate ?? &quot;&quot;), &quot;dueDate&quot;);

            if (attachment != null &amp;&amp; attachment.Length &gt; 0)
            {
                var fileContent = new StreamContent(attachment.OpenReadStream());
                fileContent.Headers.ContentType = new System.Net.Http.Headers.MediaTypeHeaderValue(attachment.ContentType);
                formData.Add(fileContent, &quot;attachment&quot;, attachment.FileName);
            }

            var response = await _httpClient.PostAsync(_functionUrl, formData);

            if (response.IsSuccessStatusCode)
            {
                var task = new TaskItem
                {
                    Title = title,
                    Description = description,
                    DueDate = dueDate
                };
                _tasks.Add(task); // Still using in-memory for display; later replace with Cosmos DB read
                return RedirectToAction(&quot;Index&quot;);
            }

            ModelState.AddModelError(&quot;&quot;, &quot;Failed to create task.&quot;);
            return View(&quot;Index&quot;, _tasks);
        }
    }
}
</code></pre>
<h4 id="update-taskitemcs-to-include-attachmenturl">Update TaskItem.cs to Include AttachmentUrl:</h4>
<ul>
<li>Open TaskManagerWeb/Models/TaskItem.cs and make these changes:</li>
</ul>
<pre><code class="language-csharp">namespace TaskManagerWeb.Models
{
    public class TaskItem
    {
        public string id { get; set; } = System.Guid.NewGuid().ToString();
        public string? Title { get; set; }
        public string? Description { get; set; }
        public string? DueDate { get; set; }
        public string? AttachmentUrl { get; set; } // Add this
    }
}
</code></pre>
<ul>
<li>
<p>Change back to the TaskManagerWeb Directory and push up the change</p>
</li>
<li>
<p>Adjust TaskManagerWeb/Program.cs to include the AddHttpClient</p>
</li>
</ul>
<pre><code class="language-csharp">using Microsoft.AspNetCore.Builder;
using Microsoft.Extensions.DependencyInjection;
using Microsoft.Extensions.Hosting;

var builder = WebApplication.CreateBuilder(args);

// Add services to the container
builder.Services.AddControllersWithViews();
builder.Services.AddHttpClient(); // Register IHttpClientFactory

var app = builder.Build();

// Configure the HTTP request pipeline
if (!app.Environment.IsDevelopment())
{
    app.UseExceptionHandler(&quot;/Home/Error&quot;);
    app.UseHsts();
}

app.UseHttpsRedirection();
app.UseStaticFiles();
app.UseRouting();
app.UseAuthorization();

app.MapControllerRoute(
    name: &quot;default&quot;,
    pattern: &quot;{controller=Home}/{action=Index}/{id?}&quot;);

app.Run();
</code></pre>
<pre><code class="language-powershell">az webapp up --name taskmanagerweb-jwashburn --resource-group az204exam --sku F1 --location westus
</code></pre>
<h2 id="application-insights">Application Insights</h2>
<p>At this point you are likely hitting app errors and other problems as this code is AI generated and not tested at any real level of scrutiny.  So lets get App Insights going to help troubleshoot the problem</p>
<h3 id="create-application-insights">Create Application Insights</h3>
<p>In the Azure Portal create an Appliction Insights resource
- Use the same resource group you have been using
- Setup a name like taskmanager-insights
- Leave the rest defaults
- Retrieve the Connection String
-- Go to the new Application Insights resource &gt; Overview tab.
- Copy the Connection String (e.g., InstrumentationKey=...;IngestionEndpoint=...). - Save this for later we are going to need it.</p>
<h3 id="integrate-with-app-service">Integrate with App Service</h3>
<p>Navigate to the TaskManagerWeb directory and add the required package</p>
<pre><code class="language-powershell">dotnet add package Microsoft.ApplicationInsights.AspNetCore
</code></pre>
<p>Modify TaskManagerWeb/Program.cs to initialize Application Insights.</p>
<p>Replace the existing code with</p>
<pre><code class="language-csharp">using Microsoft.AspNetCore.Builder;
using Microsoft.Extensions.DependencyInjection;
using Microsoft.Extensions.Hosting;
using Microsoft.ApplicationInsights.AspNetCore.Extensions; // Add this

var builder = WebApplication.CreateBuilder(args);

// Add services to the container
builder.Services.AddControllersWithViews();
builder.Services.AddHttpClient();

// Add Application Insights
builder.Services.AddApplicationInsightsTelemetry();

var app = builder.Build();

// Configure the HTTP request pipeline
if (!app.Environment.IsDevelopment())
{
    app.UseExceptionHandler(&quot;/Home/Error&quot;);
    app.UseHsts();
}

app.UseHttpsRedirection();
app.UseStaticFiles();
app.UseRouting();
app.UseAuthorization();

app.MapControllerRoute(
    name: &quot;default&quot;,
    pattern: &quot;{controller=Home}/{action=Index}/{id?}&quot;);

app.Run();
</code></pre>
<h3 id="add-connection-string-to-app-service">Add Connection String to App Service</h3>
<ul>
<li>In the Azure Portal, go to your App Service (taskmanagerweb-yourname).</li>
<li>Navigate to Settings &gt; Environment Variables (or Configuration).</li>
<li>Add a new application setting:</li>
<li>Name: APPLICATIONINSIGHTS_CONNECTION_STRING</li>
<li>Value: Paste the Connection String from Step 1.</li>
</ul>
<h3 id="redeploy-the-web-app">Redeploy the Web App</h3>
<ul>
<li>Ensure you’re in the TaskManagerWeb directory</li>
</ul>
<pre><code class="language-powershell">cd TaskManagerWeb
dotnet build
az webapp up --name taskmanagerweb-yourname --resource-group az204exam --sku F1 --location westus
</code></pre>
<h3 id="you-have-completed-the-add-app-insights-to-app-service-section">You have completed the Add App Insights to App Service Section.</h3>
<hr />
<h3 id="integrate-with-azure-function">Integrate with Azure Function</h3>
<ul>
<li>Add the Application Insights SDK:</li>
<li>In the TaskManagerFunctions directory:</li>
</ul>
<pre><code class="language-powershell">dotnet add package Microsoft.Azure.WebJobs.Logging.ApplicationInsights
</code></pre>
<ul>
<li>Add Connection String to Function App:</li>
<li>In the Azure Portal, go to your Function App (taskmanagerfunc-yourname).</li>
<li>Navigate to Settings &gt; Environment Variables.</li>
<li>Add a new application setting:</li>
<li>Name: APPLICATIONINSIGHTS_CONNECTION_STRING</li>
<li>Value: Paste the same Connection String from Step 1.</li>
</ul>
<h3 id="redeploy-the-function-app">Redeploy the Function App:</h3>
<ul>
<li>Ensure you’re in the TaskManagerFunctions directory:</li>
</ul>
<pre><code class="language-powershell">cd TaskManagerFunctions
func azure functionapp publish taskmanagerfunc-yourname
</code></pre>
<h2 id="go-test-in-azure">Go Test in Azure</h2>
<p>STILL to DO
AD Auth
App Insights</p>
<h1 id="cost-estimate">Cost Estimate</h1>
<ul>
<li><strong>App Service:</strong>  Free (F1 tier).</li>
<li><strong>Azure Functions:</strong> ~$0.05–$0.10 (Consumption plan, light usage).</li>
<li><strong>Cosmos DB: Free</strong> (1000 RU/s tier).</li>
<li><strong>Blob Storage:</strong> ~$0.05–$0.10 (minimal storage/transactions).</li>
<li><strong>Azure AD/Application Insights:</strong> Free.</li>
</ul>
<h2 id="total-010025-for-initial-setup-and-testing-well-within-200-credit">Total: ~$0.10–$0.25 for initial setup and testing, well within $200 credit.</h2>
<h1 id="learning-outcomes">Learning Outcomes</h1>
<ul>
<li>Deploy and configure Azure App Service and Functions.</li>
<li>Work with Cosmos DB for NoSQL data and Blob Storage for files.</li>
<li>Implement authentication and RBAC.</li>
<li>Monitor apps with Application Insights</li>
</ul>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.f8cc74c7.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.c8b220af.min.js"></script>
      
    
  </body>
</html>