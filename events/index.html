
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../api/">
      
      
        <link rel="next" href="../message/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.11">
    
    
      
        <title>Develop event-based solutions - AZ-204 Study Materials</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.4af4bdda.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#develop-event-based-solutions" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="AZ-204 Study Materials" class="md-header__button md-logo" aria-label="AZ-204 Study Materials" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            AZ-204 Study Materials
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Develop event-based solutions
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="AZ-204 Study Materials" class="md-nav__button md-logo" aria-label="AZ-204 Study Materials" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    AZ-204 Study Materials
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Develop Azure compute solutions
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Develop Azure compute solutions
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../acr/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Implement containerized solutions
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../webapp/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Implement Azure App Service Web Apps
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../functions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Implement Azure Functions
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Develop for Azure storage
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Develop for Azure storage
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../storage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Develop solutions that use Azure Blob Storage
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cosmos/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Develop solutions that use Azure Cosmos DB
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Implement Azure security
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Implement Azure security
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../auth/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Implement user authentication and authorization
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../secure/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Implement secure Azure solutions
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Monitor and troubleshoot Azure solutions
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Monitor and troubleshoot Azure solutions
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../appinsights/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Monitor and troubleshoot solutions by using Application Insights
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" checked>
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Connect to and consume Azure services and third-party services
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Connect to and consume Azure services and third-party services
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Implement API Management
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Develop event-based solutions
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Develop event-based solutions
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    <span class="md-ellipsis">
      Prerequisites
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#implement-solutions-that-use-azure-event-grid" class="md-nav__link">
    <span class="md-ellipsis">
      Implement Solutions that Use Azure Event Grid
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Implement Solutions that Use Azure Event Grid">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#steps" class="md-nav__link">
    <span class="md-ellipsis">
      Steps
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#implement-solutions-that-use-azure-event-hub" class="md-nav__link">
    <span class="md-ellipsis">
      Implement Solutions that Use Azure Event Hub
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Implement Solutions that Use Azure Event Hub">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#steps_1" class="md-nav__link">
    <span class="md-ellipsis">
      Steps
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#verify-all-topics" class="md-nav__link">
    <span class="md-ellipsis">
      Verify All Topics
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clean-up-optional" class="md-nav__link">
    <span class="md-ellipsis">
      Clean Up (Optional)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#next-steps" class="md-nav__link">
    <span class="md-ellipsis">
      Next Steps
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../message/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Develop message-based solutions
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    <span class="md-ellipsis">
      Prerequisites
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#implement-solutions-that-use-azure-event-grid" class="md-nav__link">
    <span class="md-ellipsis">
      Implement Solutions that Use Azure Event Grid
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Implement Solutions that Use Azure Event Grid">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#steps" class="md-nav__link">
    <span class="md-ellipsis">
      Steps
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#implement-solutions-that-use-azure-event-hub" class="md-nav__link">
    <span class="md-ellipsis">
      Implement Solutions that Use Azure Event Hub
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Implement Solutions that Use Azure Event Hub">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#steps_1" class="md-nav__link">
    <span class="md-ellipsis">
      Steps
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#verify-all-topics" class="md-nav__link">
    <span class="md-ellipsis">
      Verify All Topics
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clean-up-optional" class="md-nav__link">
    <span class="md-ellipsis">
      Clean Up (Optional)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#next-steps" class="md-nav__link">
    <span class="md-ellipsis">
      Next Steps
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="develop-event-based-solutions">Develop Event-Based Solutions</h1>
<p>This guide covers the AZ-204 exam topics for developing event-based solutions using Azure Event Grid and Azure Event Hub. We’ll enhance our <code>TaskManagerWeb</code> (WebApp) and <code>TaskManagerFunctions</code> (Function App) to handle events, integrating with our existing setup (including Cosmos DB and API Management). We’ll use Event Grid to trigger actions on task creation and Event Hub to stream task updates for processing.</p>
<h2 id="prerequisites">Prerequisites</h2>
<ul>
<li><strong>Azure Subscription</strong> (Free tier or $200 credit recommended).</li>
<li><strong>Existing Resource Group</strong> (<code>az204exam</code>).</li>
<li><strong>Deployed Apps</strong>:</li>
<li>WebApp: <code>taskmanagerweb-yourname</code> (ASP.NET Core MVC, Free F1 tier).</li>
<li>Function App: <code>taskmanagerfunc-yourname</code> (.NET 8 isolated, Consumption plan).</li>
<li>Cosmos DB: <code>taskmanagercosmos</code> with <code>TasksDB/Tasks</code>.</li>
<li>API Management: <code>taskmanagerapim-yourname</code>.</li>
<li><strong>Tools</strong>:</li>
<li><a href="https://learn.microsoft.com/en-us/dotnet/core/install/windows?tabs=net80#install-with-windows-package-manager-winget">.NET SDK 8.0</a>: <code>winget install Microsoft.DotNet.SDK.8</code>.</li>
<li><a href="https://learn.microsoft.com/en-us/cli/azure/install-azure-cli">Azure CLI</a>.</li>
<li><a href="https://github.com/Azure/azure-functions-core-tools/releases">Azure Functions Core Tools</a>.</li>
</ul>
<h2 id="implement-solutions-that-use-azure-event-grid">Implement Solutions that Use Azure Event Grid</h2>
<p>We’ll use Event Grid to trigger a new Function when a task is created in Cosmos DB, sending a notification via a webhook (simulated by another Function).</p>
<h3 id="steps">Steps</h3>
<p><strong>Create an Event Grid Trigger Function</strong>:</p>
<p>In <code>TaskManagerFunctions</code> directory:</p>
<pre><code class="language-bash">cd TaskManagerFunctions
func new --template &quot;Azure Event Grid Trigger&quot; --name TaskCreatedNotification
</code></pre>
<p>Update <code>TaskCreatedNotification.cs</code>:</p>
<pre><code class="language-csharp">using Microsoft.Azure.Functions.Worker;
using Microsoft.Extensions.Logging;
using System.Text.Json;

namespace TaskManagerFunctions
{
    public class TaskCreatedNotification
    {
        private readonly ILogger&lt;TaskCreatedNotification&gt; _logger;

        public TaskCreatedNotification(ILogger&lt;TaskCreatedNotification&gt; logger)
        {
            _logger = logger;
        }

        public class TaskItem
        {
            public string id { get; set; }
            public string Title { get; set; }
            public string Description { get; set; }
            public string DueDate { get; set; }
        }

        [Function(&quot;TaskCreatedNotification&quot;)]
        public async Task Run([EventGridTrigger] object eventGridEvent)
        {
            _logger.LogInformation(&quot;Event Grid trigger fired: {event}&quot;, JsonSerializer.Serialize(eventGridEvent));

            // Extract task data (simplified for exam prep)
            var eventData = JsonSerializer.Deserialize&lt;JsonElement&gt;(JsonSerializer.Serialize(eventGridEvent));
            if (eventData.TryGetProperty(&quot;data&quot;, out var data))
            {
                var task = JsonSerializer.Deserialize&lt;TaskItem&gt;(data.GetRawText());
                _logger.LogInformation($&quot;Task created: {task.Title}, ID: {task.id}&quot;);

                // Simulate notification (e.g., call a webhook)
                // In exam context, logging is enough to show event handling
            }
        }
    }
}
</code></pre>
<p><strong>Set Up Event Grid Topic</strong>:</p>
<p>In Azure Portal, go to <strong>Create a resource</strong> &gt; <strong>Event Grid Topic</strong> &gt; <strong>Create</strong>.</p>
<p>Configure:</p>
<ul>
<li>Resource group: <code>az204exam</code>.</li>
<li>Name: <code>taskcreatedtopic</code>.</li>
<li>Location: Same as apps (e.g., West US 3).</li>
</ul>
<p><strong>Configure Cosmos DB Event Source</strong>:</p>
<p>In <code>taskmanagercosmos</code> &gt; <strong>Events</strong> &gt; <strong>Add Event Grid integration</strong>.</p>
<p>Select:</p>
<ul>
<li>Topic: <code>taskcreatedtopic</code>.</li>
<li>Event types: <code>Microsoft.Azure.CosmosDB.DocumentCreated</code>.</li>
<li>Container: <code>TasksDB/Tasks</code>.</li>
</ul>
<p>Save.</p>
<p><strong>Subscribe to Event Grid Topic</strong>:</p>
<p>In Portal, go to <strong>Event Grid Topics</strong> &gt; <code>taskcreatedtopic</code> &gt; <strong>+ Event Subscription</strong>.</p>
<p>Configure:</p>
<ul>
<li>Name: <code>taskcreatedsub</code>.</li>
<li>Event type: <code>DocumentCreated</code>.</li>
<li>Endpoint type: <strong>Azure Function</strong>.</li>
<li>Endpoint: Select <code>taskmanagerfunc-yourname</code> &gt; <code>TaskCreatedNotification</code>.</li>
</ul>
<p><strong>Deploy Function</strong>:</p>
<ul>
<li>Deploy updated Function App:</li>
</ul>
<pre><code class="language-bash">func azure functionapp publish taskmanagerfunc-yourname
</code></pre>
<p><strong>Test Event Grid</strong>:
- Trigger a task creation via APIM (from <code>apimanagement.md</code>):</p>
<pre><code class="language-bash">curl -X POST https://taskmanagerapim-yourname.azure-api.net/functions/managetask -H &quot;Ocp-Apim-Subscription-Key: [your-key]&quot; -H &quot;Content-Type: application/json&quot; -d '{&quot;Title&quot;:&quot;Event Grid Task&quot;,&quot;Description&quot;:&quot;Test&quot;,&quot;DueDate&quot;:&quot;2025-04-15&quot;}'
</code></pre>
<ul>
<li>Verify:</li>
<li>In Portal, go to <code>taskmanagerfunc-yourname</code> &gt; <strong>Functions</strong> &gt; <code>TaskCreatedNotification</code> &gt; <strong>Monitor</strong> &gt; <strong>Logs</strong>.</li>
<li>Look for <code>Task created: Event Grid Task, ID: [guid]</code>.</li>
<li>Check Cosmos DB &gt; <code>TasksDB/Tasks</code> to confirm the task exists.</li>
</ul>
<h2 id="implement-solutions-that-use-azure-event-hub">Implement Solutions that Use Azure Event Hub</h2>
<p>We’ll use Event Hub to stream task updates from the WebApp, processing them with a new Function to log or analyze changes.</p>
<h3 id="steps_1">Steps</h3>
<p><strong>Create Event Hub Namespace and Hub</strong>:</p>
<p>In Portal, go to <strong>Create a resource</strong> &gt; <strong>Event Hubs</strong> &gt; <strong>Create</strong>.</p>
<p>Configure:</p>
<ul>
<li>Resource group: <code>az204exam</code>.</li>
<li>Namespace name: <code>taskmanagerhub-yourname</code>.</li>
<li>Location: West US 3.</li>
<li>Pricing tier: <strong>Basic</strong> (exam-friendly).</li>
<li>Create.</li>
<li>Inside the namespace, create an Event Hub:</li>
<li>Name: <code>taskevents</code>.</li>
<li>Partition count: 2 (minimal for exam).</li>
<li>Message retention: 1 day.</li>
</ul>
<p><strong>Get Connection String</strong>:</p>
<p>In <code>taskmanagerhub-yourname</code> &gt; <strong>Shared access policies</strong> &gt; <strong>RootManageSharedAccessKey</strong>.</p>
<p>Copy the <strong>Primary Connection String</strong>.</p>
<p>Add to Function App:
  - In <code>taskmanagerfunc-yourname</code> &gt; <strong>Settings</strong> &gt; <strong>Environment Variables</strong>.
  - Add:
     - Name: <code>EventHubConnection</code>.
     - Value: <code>[your-connection-string]</code>.
  - Save.</p>
<p><strong>Update WebApp to Send Events</strong>:
In <code>TaskManagerWeb</code>, add Event Hubs SDK:</p>
<pre><code class="language-bash">cd TaskManagerWeb
dotnet add package Azure.Messaging.EventHubs
</code></pre>
<p>Update <code>Controllers/HomeController.cs</code>:</p>
<pre><code class="language-csharp">using Microsoft.AspNetCore.Mvc;
using TaskManagerWeb.Models;
using System.Collections.Generic;
using Azure.Messaging.EventHubs;
using Azure.Messaging.EventHubs.Producer;
using System.Text;
using System.Text.Json;

namespace TaskManagerWeb.Controllers
{
    public class HomeController : Controller
    {
        private static List&lt;TaskItem&gt; _tasks = new List&lt;TaskItem&gt;();
        private readonly EventHubProducerClient _eventHubClient;

        public HomeController()
        {
            // Use environment variable in Azure; fallback for local testing
            var connectionString = Environment.GetEnvironmentVariable(&quot;EventHubConnection&quot;) ?? &quot;your-local-connection-string&quot;;
            _eventHubClient = new EventHubProducerClient(connectionString, &quot;taskevents&quot;);
        }

        public IActionResult Index()
        {
            return View(_tasks);
        }

        [HttpPost]
        public async Task&lt;IActionResult&gt; Create(string title, string description, string dueDate)
        {
            var task = new TaskItem
            {
                Title = title,
                Description = description,
                DueDate = dueDate
            };
            _tasks.Add(task);

            // Send event to Event Hub
            var eventData = new EventData(Encoding.UTF8.GetBytes(JsonSerializer.Serialize(task)));
            await _eventHubClient.SendAsync(new[] { eventData });

            return RedirectToAction(&quot;Index&quot;);
        }
    }
}
</code></pre>
<p>Add to <code>appsettings.json</code>:</p>
<pre><code class="language-json">{
  &quot;EventHubConnection&quot;: &quot;&quot;
}
</code></pre>
<p>Deploy WebApp:</p>
<pre><code class="language-bash">az webapp up --name taskmanagerweb-yourname --resource-group az204exam
</code></pre>
<p>In <code>taskmanagerweb-yourname</code> &gt; <strong>Settings</strong> &gt; <strong>Environment Variables</strong>, add:
Name: <code>EventHubConnection</code>.
Value: <code>[your-connection-string]</code>.</p>
<p><strong>Create Event Hub Trigger Function</strong>:
In <code>TaskManagerFunctions</code>:</p>
<pre><code class="language-bash">func new --template &quot;Event Hub Trigger&quot; --name ProcessTaskEvents
</code></pre>
<p>Update <code>ProcessTaskEvents.cs</code>:</p>
<pre><code class="language-csharp">using Microsoft.Azure.Functions.Worker;
using Microsoft.Extensions.Logging;
using System.Text;

namespace TaskManagerFunctions
{
    public class ProcessTaskEvents
    {
        private readonly ILogger&lt;ProcessTaskEvents&gt; _logger;

        public ProcessTaskEvents(ILogger&lt;ProcessTaskEvents&gt; logger)
        {
            _logger = logger;
        }

        [Function(&quot;ProcessTaskEvents&quot;)]
        public void Run([EventHubTrigger(&quot;taskevents&quot;, Connection = &quot;EventHubConnection&quot;)] string[] events)
        {
            foreach (var eventData in events)
            {
                _logger.LogInformation($&quot;Event Hub message: {eventData}&quot;);
            }
        }
    }
}
</code></pre>
<p><strong>Test Locally (Optional)</strong>:
Update <code>local.settings.json</code>:</p>
<pre><code class="language-json">{
    &quot;IsEncrypted&quot;: false,
    &quot;Values&quot;: {
        &quot;AzureWebJobsStorage&quot;: &quot;UseDevelopmentStorage=true&quot;,
        &quot;FUNCTIONS_WORKER_RUNTIME&quot;: &quot;dotnet-isolated&quot;,
        &quot;CosmosDBConnection&quot;: &quot;[your-cosmos-connection]&quot;,
        &quot;EventHubConnection&quot;: &quot;[your-eventhub-connection]&quot;
    }
}
</code></pre>
<p>Run WebApp:</p>
<pre><code class="language-bash">cd TaskManagerWeb
dotnet run
</code></pre>
<p>Create a task via <code>https://localhost:5001</code>.
Run Function:</p>
<pre><code class="language-bash">cd ../TaskManagerFunctions
func start
</code></pre>
<p>Check console for <code>Event Hub message: {"id":"[guid]","Title":"Test Task",...}</code>.</p>
<p><strong>Deploy and Test</strong>:
Deploy Function:</p>
<pre><code class="language-bash">func azure functionapp publish taskmanagerfunc-yourname
</code></pre>
<p>Test:</p>
<p>Access <code>https://taskmanagerweb-yourname.azurewebsites.net</code>, create a task.</p>
<p>In Portal, go to <code>taskmanagerfunc-yourname</code> &gt; <strong>Functions</strong> &gt; <code>ProcessTaskEvents</code> &gt; <strong>Monitor</strong> &gt; <strong>Logs</strong>.</p>
<p>Verify logs show <code>Event Hub message</code> with task data.</p>
<p>Check Event Hub metrics:</p>
<p>In <code>taskmanagerhub-yourname</code> &gt; <strong>Metrics</strong>, look for <code>Incoming Messages</code>.</p>
<h2 id="verify-all-topics">Verify All Topics</h2>
<ul>
<li><strong>Event Grid</strong>: Triggered <code>TaskCreatedNotification</code> on Cosmos DB task creation.</li>
<li><strong>Event Hub</strong>: Streamed WebApp task updates to <code>ProcessTaskEvents</code>.</li>
</ul>
<h2 id="clean-up-optional">Clean Up (Optional)</h2>
<p>To avoid costs:</p>
<pre><code class="language-bash">az group delete -n az204exam --no-wait --yes
</code></pre>
<h2 id="next-steps">Next Steps</h2>
<ul>
<li>Enhance <code>TaskCreatedNotification</code> to call an external webhook (e.g., via HTTP request).</li>
<li>Scale Event Hub processing with multiple partitions for exam scenarios.</li>
<li>Move to the final topic: message-based solutions (e.g., Azure Service Bus, Queue Storage).</li>
</ul>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.f8cc74c7.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.c8b220af.min.js"></script>
      
    
  </body>
</html>