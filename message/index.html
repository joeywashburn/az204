
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../events/">
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.11">
    
    
      
        <title>Develop message-based solutions - AZ-204 Study Materials</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.4af4bdda.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#develop-message-based-solutions" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="AZ-204 Study Materials" class="md-header__button md-logo" aria-label="AZ-204 Study Materials" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            AZ-204 Study Materials
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Develop message-based solutions
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="AZ-204 Study Materials" class="md-nav__button md-logo" aria-label="AZ-204 Study Materials" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    AZ-204 Study Materials
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Develop Azure compute solutions
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Develop Azure compute solutions
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../acr/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Implement containerized solutions
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../webapp/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Implement Azure App Service Web Apps
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../functions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Implement Azure Functions
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Develop for Azure storage
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Develop for Azure storage
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../storage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Develop solutions that use Azure Blob Storage
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cosmos/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Develop solutions that use Azure Cosmos DB
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Implement Azure security
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Implement Azure security
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../auth/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Implement user authentication and authorization
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../secure/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Implement secure Azure solutions
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Monitor and troubleshoot Azure solutions
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Monitor and troubleshoot Azure solutions
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../appinsights/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Monitor and troubleshoot solutions by using Application Insights
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" checked>
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Connect to and consume Azure services and third-party services
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Connect to and consume Azure services and third-party services
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Implement API Management
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../events/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Develop event-based solutions
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Develop message-based solutions
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Develop message-based solutions
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    <span class="md-ellipsis">
      Prerequisites
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#implement-solutions-that-use-azure-service-bus" class="md-nav__link">
    <span class="md-ellipsis">
      Implement Solutions that Use Azure Service Bus
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Implement Solutions that Use Azure Service Bus">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#steps" class="md-nav__link">
    <span class="md-ellipsis">
      Steps
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#why" class="md-nav__link">
    <span class="md-ellipsis">
      Why
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#implement-solutions-that-use-azure-queue-storage-queues" class="md-nav__link">
    <span class="md-ellipsis">
      Implement Solutions that Use Azure Queue Storage Queues
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Implement Solutions that Use Azure Queue Storage Queues">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#steps_1" class="md-nav__link">
    <span class="md-ellipsis">
      Steps
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#why_1" class="md-nav__link">
    <span class="md-ellipsis">
      Why
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#verify-all-topics" class="md-nav__link">
    <span class="md-ellipsis">
      Verify All Topics
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clean-up-optional" class="md-nav__link">
    <span class="md-ellipsis">
      Clean Up (Optional)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#next-steps" class="md-nav__link">
    <span class="md-ellipsis">
      Next Steps
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    <span class="md-ellipsis">
      Prerequisites
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#implement-solutions-that-use-azure-service-bus" class="md-nav__link">
    <span class="md-ellipsis">
      Implement Solutions that Use Azure Service Bus
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Implement Solutions that Use Azure Service Bus">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#steps" class="md-nav__link">
    <span class="md-ellipsis">
      Steps
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#why" class="md-nav__link">
    <span class="md-ellipsis">
      Why
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#implement-solutions-that-use-azure-queue-storage-queues" class="md-nav__link">
    <span class="md-ellipsis">
      Implement Solutions that Use Azure Queue Storage Queues
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Implement Solutions that Use Azure Queue Storage Queues">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#steps_1" class="md-nav__link">
    <span class="md-ellipsis">
      Steps
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#why_1" class="md-nav__link">
    <span class="md-ellipsis">
      Why
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#verify-all-topics" class="md-nav__link">
    <span class="md-ellipsis">
      Verify All Topics
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clean-up-optional" class="md-nav__link">
    <span class="md-ellipsis">
      Clean Up (Optional)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#next-steps" class="md-nav__link">
    <span class="md-ellipsis">
      Next Steps
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="develop-message-based-solutions">Develop Message-Based Solutions</h1>
<p>This guide covers the AZ-204 exam topics for developing message-based solutions using Azure Service Bus and Azure Queue Storage. We'll extend our <code>TaskManagerWeb</code> (WebApp) and <code>TaskManagerFunctions</code> (Function App) to handle task-related messages, integrating with our existing setup (Cosmos DB, API Management, Event Grid, and Event Hub). We'll use Service Bus for reliable task notifications and Queue Storage for background task processing.</p>
<h2 id="prerequisites">Prerequisites</h2>
<ul>
<li><strong>Azure Subscription</strong> (Free tier or $200 credit recommended).</li>
<li><strong>Existing Resource Group</strong> (<code>az204exam</code>).</li>
<li><strong>Deployed Apps</strong>:</li>
<li>WebApp: <code>taskmanagerweb-yourname</code> (ASP.NET Core MVC, Free F1 tier).</li>
<li>Function App: <code>taskmanagerfunc-yourname</code> (.NET 8 isolated, Consumption plan).</li>
<li>Cosmos DB: <code>taskmanagercosmos</code> with <code>TasksDB/Tasks</code>.</li>
<li>API Management: <code>taskmanagerapim-yourname</code>.</li>
<li><strong>Tools</strong>:</li>
<li><a href="https://learn.microsoft.com/en-us/dotnet/core/install/windows?tabs=net80#install-with-windows-package-manager-winget">.NET SDK 8.0</a>: <code>winget install Microsoft.DotNet.SDK.8</code>.</li>
<li><a href="https://learn.microsoft.com/en-us/cli/azure/install-azure-cli">Azure CLI</a>.</li>
<li><a href="https://github.com/Azure/azure-functions-core-tools/releases">Azure Functions Core Tools</a>.</li>
</ul>
<h2 id="implement-solutions-that-use-azure-service-bus">Implement Solutions that Use Azure Service Bus</h2>
<p>We'll use Azure Service Bus to send task creation notifications from the WebApp, processed by a Function App to log or simulate sending emails.</p>
<h3 id="steps">Steps</h3>
<p>Follow these steps to implement Azure Service Bus:</p>
<ol>
<li>
<p>Create a Service Bus Namespace and Queue.</p>
</li>
<li>
<p>Get the Service Bus connection string and add it to the Function App.</p>
</li>
<li>
<p>Update the WebApp to send messages to Service Bus.</p>
</li>
<li>
<p>Create a Service Bus Trigger Function to process messages.</p>
</li>
<li>
<p>Test locally (optional).</p>
</li>
<li>
<p>Deploy and test the solution in Azure.</p>
</li>
</ol>
<p><strong>Step 1: Create Service Bus Namespace and Queue</strong></p>
<p>In the Azure Portal, go to <strong>Create a resource</strong> &gt; <strong>Service Bus</strong> &gt; <strong>Create</strong>. Configure:</p>
<ul>
<li>Resource group: <code>az204exam</code>.</li>
<li>Namespace name: <code>taskmanagersb-yourname</code> (globally unique).</li>
<li>Location: Same as apps (e.g., West US 3).</li>
<li>Pricing tier: <strong>Basic</strong> (exam-friendly, low cost).</li>
</ul>
<p>Inside the namespace, create a queue:</p>
<ul>
<li>Name: <code>tasknotifications</code>.</li>
<li>Defaults: Max size 1 GB, message TTL 14 days.</li>
</ul>
<p>Alternatively, use the Azure CLI:</p>
<pre><code class="language-bash">az servicebus namespace create --name taskmanagersb-yourname --resource-group az204exam --location westus3 --sku Basic
az servicebus queue create --name tasknotifications --namespace-name taskmanagersb-yourname --resource-group az204exam
</code></pre>
<p><strong>Step 2: Get Connection String and Add to Function App</strong></p>
<p>In <code>taskmanagersb-yourname</code> &gt; <strong>Shared access policies</strong> &gt; <strong>RootManageSharedAccessKey</strong>, copy the <strong>Primary Connection String</strong>.</p>
<p>Add it to the Function App:</p>
<ul>
<li>In <code>taskmanagerfunc-yourname</code> &gt; <strong>Settings</strong> &gt; <strong>Environment Variables</strong>.</li>
<li>Add:</li>
<li>Name: <code>ServiceBusConnection</code>.</li>
<li>Value: <code>[your-connection-string]</code>.</li>
<li>Save.</li>
</ul>
<p><strong>Step 3: Update WebApp to Send Messages</strong></p>
<p>In <code>TaskManagerWeb</code>, add the Service Bus SDK and update the controller to send messages.</p>
<pre><code class="language-bash">cd TaskManagerWeb
dotnet add package Azure.Messaging.ServiceBus
</code></pre>
<p>Update <code>Controllers/HomeController.cs</code>:</p>
<pre><code class="language-csharp">using Microsoft.AspNetCore.Mvc;
using TaskManagerWeb.Models;
using System.Collections.Generic;
using Azure.Messaging.ServiceBus;
using System.Text.Json;

namespace TaskManagerWeb.Controllers
{
    public class HomeController : Controller
    {
        private static List&lt;TaskItem&gt; _tasks = new List&lt;TaskItem&gt;();
        private readonly ServiceBusClient _serviceBusClient;

        public HomeController()
        {
            var connectionString = Environment.GetEnvironmentVariable(&quot;ServiceBusConnection&quot;) ?? &quot;your-local-connection-string&quot;;
            _serviceBusClient = new ServiceBusClient(connectionString);
        }

        public IActionResult Index()
        {
            return View(_tasks);
        }

        [HttpPost]
        public async Task&lt;IActionResult&gt; Create(string title, string description, string dueDate)
        {
            var task = new TaskItem
            {
                Title = title,
                Description = description,
                DueDate = dueDate
            };
            _tasks.Add(task);

            // Send message to Service Bus
            var sender = _serviceBusClient.CreateSender(&quot;tasknotifications&quot;);
            var message = new ServiceBusMessage(JsonSerializer.Serialize(task));
            await sender.SendMessageAsync(message);
            await sender.DisposeAsync();

            return RedirectToAction(&quot;Index&quot;);
        }
    }
}
</code></pre>
<p>Update <code>appsettings.json</code>:</p>
<pre><code class="language-json">{
  &quot;ServiceBusConnection&quot;: &quot;&quot;,
  &quot;EventHubConnection&quot;: &quot;&quot;
}
</code></pre>
<p>Deploy the WebApp and add the environment variable:</p>
<pre><code class="language-bash">az webapp up --name taskmanagerweb-yourname --resource-group az204exam
</code></pre>
<p>In <code>taskmanagerweb-yourname</code> &gt; <strong>Settings</strong> &gt; <strong>Environment Variables</strong>, add:</p>
<ul>
<li>Name: <code>ServiceBusConnection</code>.</li>
<li>Value: <code>[your-connection-string]</code>.</li>
</ul>
<p><strong>Step 4: Create Service Bus Trigger Function</strong></p>
<p>In <code>TaskManagerFunctions</code>, create the Service Bus Trigger Function and update its code.</p>
<pre><code class="language-bash">cd TaskManagerFunctions
func new --template &quot;Azure Service Bus Queue Trigger&quot; --name ProcessTaskNotification
</code></pre>
<p>Update <code>ProcessTaskNotification.cs</code>:</p>
<pre><code class="language-csharp">using Microsoft.Azure.Functions.Worker;
using Microsoft.Extensions.Logging;

namespace TaskManagerFunctions
{
    public class ProcessTaskNotification
    {
        private readonly ILogger&lt;ProcessTaskNotification&gt; _logger;

        public ProcessTaskNotification(ILogger&lt;ProcessTaskNotification&gt; logger)
        {
            _logger = logger;
        }

        [Function(&quot;ProcessTaskNotification&quot;)]
        public void Run([ServiceBusQueueTrigger(&quot;tasknotifications&quot;, Connection = &quot;ServiceBusConnection&quot;)] string message)
        {
            _logger.LogInformation($&quot;Service Bus message: {message}&quot;);
            // Simulate email notification or logging
        }
    }
}
</code></pre>
<p><strong>Step 5: Test Locally (Optional)</strong></p>
<p>Update <code>local.settings.json</code> in <code>TaskManagerFunctions</code>:</p>
<pre><code class="language-json">{
    &quot;IsEncrypted&quot;: false,
    &quot;Values&quot;: {
        &quot;AzureWebJobsStorage&quot;: &quot;UseDevelopmentStorage=true&quot;,
        &quot;FUNCTIONS_WORKER_RUNTIME&quot;: &quot;dotnet-isolated&quot;,
        &quot;CosmosDBConnection&quot;: &quot;[your-cosmos-connection]&quot;,
        &quot;EventHubConnection&quot;: &quot;[your-eventhub-connection]&quot;,
        &quot;ServiceBusConnection&quot;: &quot;[your-servicebus-connection]&quot;
    }
}
</code></pre>
<p>Run the WebApp and Function locally to test:</p>
<pre><code class="language-bash">cd TaskManagerWeb
dotnet run
</code></pre>
<p>Create a task via <code>https://localhost:5001</code>.</p>
<p>Run the Function in a separate terminal:</p>
<pre><code class="language-bash">cd ../TaskManagerFunctions
func start
</code></pre>
<p>Check the Function's console for <code>Service Bus message: {"id":"[guid]","Title":"Test Task",...}</code>.</p>
<p><strong>Step 6: Deploy and Test</strong></p>
<p>Deploy the Function and test in Azure.</p>
<pre><code class="language-bash">func azure functionapp publish taskmanagerfunc-yourname
</code></pre>
<p>Test:</p>
<ul>
<li>Access <code>https://taskmanagerweb-yourname.azurewebsites.net</code> and create a task.</li>
<li>In the Azure Portal, go to <code>taskmanagerfunc-yourname</code> &gt; <strong>Functions</strong> &gt; <code>ProcessTaskNotification</code> &gt; <strong>Monitor</strong> &gt; <strong>Logs</strong>.</li>
<li>Verify logs show <code>Service Bus message</code> with task data.</li>
<li>Check Service Bus metrics in <code>taskmanagersb-yourname</code> &gt; <strong>Queues</strong> &gt; <code>tasknotifications</code> &gt; <strong>Metrics</strong>; confirm <code>Messages</code> count increases.</li>
</ul>
<h3 id="why">Why</h3>
<p>Service Bus ensures reliable, ordered message delivery for notifications, a key exam topic, integrating seamlessly with our WebApp.</p>
<h2 id="implement-solutions-that-use-azure-queue-storage-queues">Implement Solutions that Use Azure Queue Storage Queues</h2>
<p>We'll use Queue Storage to queue tasks for background processing (e.g., validation or formatting), triggered by a Function.</p>
<h3 id="steps_1">Steps</h3>
<p>Follow these steps to implement Azure Queue Storage:</p>
<ol>
<li>
<p>Create a Storage Account and Queue (if not already created).</p>
</li>
<li>
<p>Get the Storage connection string and confirm it's in the Function App.</p>
</li>
<li>
<p>Update the Function App to enqueue tasks.</p>
</li>
<li>
<p>Create a Queue Trigger Function to process queue messages.</p>
</li>
<li>
<p>Test locally (optional).</p>
</li>
<li>
<p>Deploy and test the solution in Azure.</p>
</li>
</ol>
<p><strong>Step 1: Create Storage Account and Queue</strong></p>
<p>If not already created (from <code>functions.md</code>), create a Storage Account:</p>
<pre><code class="language-bash">az storage account create --name taskmanagerstoreyourname --resource-group az204exam --location westus3 --sku Standard_LRS
</code></pre>
<p>Create a queue in the Storage Account:</p>
<p>In the Azure Portal, go to <code>taskmanagerstoreyourname</code> &gt; <strong>Queues</strong> &gt; <strong>+ Queue</strong>. Name: <code>taskqueue</code>.</p>
<p>Alternatively, use the Azure CLI:</p>
<pre><code class="language-bash">az storage queue create --name taskqueue --account-name taskmanagerstoreyourname
</code></pre>
<p><strong>Step 2: Get Connection String and Confirm in Function App</strong></p>
<p>In <code>taskmanagerstoreyourname</code> &gt; <strong>Access keys</strong>, copy the <strong>Connection string</strong> for <code>key1</code>.</p>
<p>Confirm it's added to the Function App (should already be added as <code>StorageConnection</code> from <code>functions.md</code>):</p>
<ul>
<li>In <code>taskmanagerfunc-yourname</code> &gt; <strong>Settings</strong> &gt; <strong>Environment Variables</strong>.</li>
<li>Confirm:</li>
<li>Name: <code>StorageConnection</code>.</li>
<li>Value: <code>[your-connection-string]</code>.</li>
</ul>
<p><strong>Step 3: Update Function App to Enqueue Tasks</strong></p>
<p>In <code>TaskManagerFunctions</code>, modify <code>ManageTask.cs</code> to send tasks to Queue Storage and add the Storage SDK.</p>
<pre><code class="language-bash">dotnet add package Microsoft.Azure.Functions.Worker.Extensions.Storage
</code></pre>
<p>Update <code>ManageTask.cs</code>:</p>
<pre><code class="language-csharp">using System.IO;
using System.Threading.Tasks;
using Microsoft.AspNetCore.Mvc;
using Microsoft.Azure.Functions.Worker;
using Microsoft.AspNetCore.Http;
using Microsoft.Extensions.Logging;
using Newtonsoft.Json;
using Microsoft.Azure.Cosmos;
using Microsoft.Azure.Functions.Worker.Extensions.Storage;

namespace TaskManagerFunctions
{
    public class ManageTask
    {
        private readonly ILogger&lt;ManageTask&gt; _logger;
        private readonly CosmosClient _cosmosClient;

        public ManageTask(ILogger&lt;ManageTask&gt; logger)
        {
            _logger = logger;
            _cosmosClient = new CosmosClient(Environment.GetEnvironmentVariable(&quot;CosmosDBConnection&quot;), new CosmosClientOptions { ConnectionMode = ConnectionMode.Direct });
        }

        public class TaskItem
        {
            public string id { get; set; } = Guid.NewGuid().ToString();
            public string Title { get; set; }
            public string Description { get; set; }
            public string DueDate { get; set; }
        }

        [Function(&quot;ManageTask&quot;)]
        public async Task&lt;IActionResult&gt; Run(
            [HttpTrigger(AuthorizationLevel.Function, &quot;post&quot;, &quot;get&quot;)] HttpRequest req,
            [QueueOutput(&quot;taskqueue&quot;, Connection = &quot;StorageConnection&quot;)] IAsyncCollector&lt;string&gt; queueOutput)
        {
            _logger.LogInformation(&quot;Processing task in Cosmos DB.&quot;);

            var container = _cosmosClient.GetContainer(&quot;TasksDB&quot;, &quot;Tasks&quot;);

            if (req.Method == &quot;POST&quot;)
            {
                string requestBody = await new StreamReader(req.Body).ReadToEndAsync();
                TaskItem task = JsonConvert.DeserializeObject&lt;TaskItem&gt;(requestBody);

                if (string.IsNullOrEmpty(task?.Title))
                {
                    return new BadRequestObjectResult(&quot;Please provide a title.&quot;);
                }

                task.id = Guid.NewGuid().ToString();
                await container.CreateItemAsync(task, new PartitionKey(task.id));
                _logger.LogInformation($&quot;Created task: {task.Title}&quot;);

                // Add task to queue
                await queueOutput.AddAsync(JsonConvert.SerializeObject(task));

                return new OkObjectResult(task);
            }
            else // GET
            {
                string taskId = req.Query[&quot;taskId&quot;];
                if (string.IsNullOrEmpty(taskId))
                {
                    return new BadRequestObjectResult(&quot;Please provide taskId.&quot;);
                }

                try
                {
                    var task = await container.ReadItemAsync&lt;TaskItem&gt;(taskId, new PartitionKey(taskId));
                    _logger.LogInformation($&quot;Read task: {task.Resource.Title}&quot;);
                    return new OkObjectResult(task.Resource);
                }
                catch (CosmosException ex) when (ex.StatusCode == System.Net.HttpStatusCode.NotFound)
                {
                    return new NotFoundResult();
                }
            }
        }
    }
}
</code></pre>
<p><strong>Step 4: Create Queue Trigger Function</strong></p>
<p>In <code>TaskManagerFunctions</code>, create the Queue Trigger Function and update its code.</p>
<pre><code class="language-bash">func new --template &quot;Azure Queue Storage Trigger&quot; --name ProcessTaskQueue
</code></pre>
<p>Update <code>ProcessTaskQueue.cs</code>:</p>
<pre><code class="language-csharp">using Microsoft.Azure.Functions.Worker;
using Microsoft.Extensions.Logging;

namespace TaskManagerFunctions
{
    public class ProcessTaskQueue
    {
        private readonly ILogger&lt;ProcessTaskQueue&gt; _logger;

        public ProcessTaskQueue(ILogger&lt;ProcessTaskQueue&gt; logger)
        {
            _logger = logger;
        }

        [Function(&quot;ProcessTaskQueue&quot;)]
        public void Run([QueueTrigger(&quot;taskqueue&quot;, Connection = &quot;StorageConnection&quot;)] string queueMessage)
        {
            _logger.LogInformation($&quot;Queue message: {queueMessage}&quot;);
            // Simulate task validation or processing
        }
    }
}
</code></pre>
<p><strong>Step 5: Test Locally (Optional)</strong></p>
<p>Update <code>local.settings.json</code> in <code>TaskManagerFunctions</code>:</p>
<pre><code class="language-json">{
    &quot;IsEncrypted&quot;: false,
    &quot;Values&quot;: {
        &quot;AzureWebJobsStorage&quot;: &quot;UseDevelopmentStorage=true&quot;,
        &quot;FUNCTIONS_WORKER_RUNTIME&quot;: &quot;dotnet-isolated&quot;,
        &quot;CosmosDBConnection&quot;: &quot;[your-cosmos-connection]&quot;,
        &quot;EventHubConnection&quot;: &quot;[your-eventhub-connection]&quot;,
        &quot;ServiceBusConnection&quot;: &quot;[your-servicebus-connection]&quot;,
        &quot;StorageConnection&quot;: &quot;[your-storage-connection]&quot;
    }
}
</code></pre>
<p>Run the Function locally to test:</p>
<pre><code class="language-bash">cd TaskManagerFunctions
func start
</code></pre>
<p>Trigger a task creation via APIM:</p>
<pre><code class="language-bash">curl -X POST https://taskmanagerapim-yourname.azure-api.net/functions/managetask -H &quot;Ocp-Apim-Subscription-Key: [your-key]&quot; -H &quot;Content-Type: application/json&quot; -d '{&quot;Title&quot;:&quot;Queue Task&quot;,&quot;Description&quot;:&quot;Test&quot;,&quot;DueDate&quot;:&quot;2025-04-15&quot;}'
</code></pre>
<p>Check the Function's console for <code>Queue message: {"id":"[guid]","Title":"Queue Task",...}</code>.</p>
<p><strong>Step 6: Deploy and Test</strong></p>
<p>Deploy the Function and test in Azure.</p>
<pre><code class="language-bash">func azure functionapp publish taskmanagerfunc-yourname
</code></pre>
<p>Test:</p>
<ul>
<li>Trigger a task creation via APIM (same curl command as above).</li>
<li>In the Azure Portal, go to <code>taskmanagerfunc-yourname</code> &gt; <strong>Functions</strong> &gt; <code>ProcessTaskQueue</code> &gt; <strong>Monitor</strong> &gt; <strong>Logs</strong>.</li>
<li>Verify logs show <code>Queue message</code> with task data.</li>
<li>Check Queue metrics in <code>taskmanagerstoreyourname</code> &gt; <strong>Queues</strong> &gt; <code>taskqueue</code> &gt; <strong>Metrics</strong>; confirm <code>Queue Message Count</code> increases.</li>
</ul>
<h3 id="why_1">Why</h3>
<p>Queue Storage provides simple, cost-effective message queuing for background tasks, complementing Service Bus and covering the examâ€™s requirements.</p>
<h2 id="verify-all-topics">Verify All Topics</h2>
<ul>
<li><strong>Service Bus</strong>: Sent task notifications from WebApp, processed by <code>ProcessTaskNotification</code>.</li>
<li><strong>Queue Storage</strong>: Enqueued tasks from <code>ManageTask</code>, processed by <code>ProcessTaskQueue</code>.</li>
</ul>
<h2 id="clean-up-optional">Clean Up (Optional)</h2>
<p>To avoid costs, delete all resources:</p>
<pre><code class="language-bash">az group delete -n az204exam --no-wait --yes
</code></pre>
<h2 id="next-steps">Next Steps</h2>
<ul>
<li>Enhance <code>ProcessTaskNotification</code> to simulate email sending (e.g., log to Cosmos DB).</li>
<li>Add error handling to <code>ProcessTaskQueue</code> (e.g., retry logic).</li>
<li>Review all guides (<code>acr.md</code>, <code>auth.md</code>, <code>cosmos.md</code>, <code>functions.md</code>, <code>webapp.md</code>, <code>insights.md</code>, <code>apimanagement.md</code>, <code>eventbased.md</code>, <code>messagebased.md</code>) for exam prep.</li>
</ul>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.f8cc74c7.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.c8b220af.min.js"></script>
      
    
  </body>
</html>